from pathlib import Path

import pytest


@pytest.mark.parametrize("buildername, srcdir", [("latex", "doc_test/doc_build_latex")])
def test_doc_build_latex(create_app, buildername):
    make_app = create_app[0]
    srcdir = create_app[1]
    app = make_app(buildername, srcdir=srcdir)

    app.build()

    latex_file = Path(app.outdir, "needstestdocs.tex")
    assert latex_file

    latex_content = latex_file.read_text()

    # Check table generated by Sphinxneeds has correct caption
    assert (
        "\\sphinxcaption{Table from sphinxneeds\\sphinxhyphen{}contrib \\textquotesingle"
        "{}needtable\\textquotesingle{} directive}" in latex_content
    )
